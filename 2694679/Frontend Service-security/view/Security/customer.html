<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer</title>
    <!-- librerias -->
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/litera/bootstrap.min.css" rel="stylesheet">
    <!-- ajax -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Script -->
   <script src="/Frontend Service-security/js/Features/cdn.js"></script>
   

    <title>
        Customer
      </title>
</head>
<body>

 
 
<div class="container">
<!-- <script src="/Frontend Service-security/js/Features/Butonn.js"></script> -->

  <div id="inputData">
      <form class="row g-3 needs-validation" novalidate>
          <fieldset>
             


                  <label class="col-sm-2 col-form-label">Data</label>
                  <div class="col-sm-10">
                    <form >

                   
                        <select class="form-control1" id="TypeDocument" name="TypeDocument"></select>
                        Num Document
                        <input type="hidden" id="selected_document_id" name="selected_document_id" value="">
                        <input type="text" list="document_id" class="form-control1" name="document_id"  id="document_id">
                        First Name
                        <input type="hidden" id="selected_firsName_id" name="selected_firsName_id" value="">
                        <input type="text" list="firstName_id" class="form-control1" name="firsName_id" id="firstName_id">
                        <button type="button" name="btnAgregar" class="Headboard btn btn-primary form-control1" data-bs-toggle="modal" id="searchButton" onclick="w()" data-bs-target="#staticBackdrop">
                          Agregar
                        </button>

                                    </form>           
                          </div>       


  
  <!-- Modal -->
  <legend>Customer</legend>
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="width: 140%; height: 150%; ">
          <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">Registro</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" >
              <div class="container">
                  <div id="inputdata">
                      <form class="row g-3 needs-validation" novalidate*class="row g-3 needs-validation" novalidate>
                          <fieldset class="formulario">
                              <legend>Person</legend>
                              <div class="form-group row">
                                  <label class="col-sm-2 col-form-label">first name</label>
                                  <div class="col-sm-10">
                                      <input type="hidden" name="id" id="id" value="">
                                      <input type="text" class="form-control" name="firstName" id="firstName" value=""
                                      required  placeholder="enter the first name ">
                                      <div class="valid-feedback">
                                          Looks good!
                                      </div>
                                      <div class="invalid-feedback">
                                          Ingrese el codigo.
                                      </div>
                            <br>    
                          </div>
                          
                          <label class="col-sm-2 col-form-label">last name</label>
                          <div class="col-sm-10">
                                      <input type="text" class="form-control" name="lastName" id="lastName" value=""
                                      required  placeholder="enter the  last name">
                                      <div class="valid-feedback">
                                          Looks good!
                                      </div>
                                      <div class="invalid-feedback">
                                          Ingrese el codigo.
                                      </div>
                                      <br>    
                                  </div>

                                  
                                  <label class="col-sm-2 col-form-label">Type document</label>
                                  <div class="col-sm-10">
                                              <select class="form-select" id="t_document"></select>
                                              <div class="valid-feedback">
                                                  Looks good!
                                              </div>
                                              <div class="invalid-feedback">
                                                  Ingrese el codigo.
                                              </div>
                                              <br>
                                          </div>   
                                          
                                          <label class="col-sm-2 col-form-label">Document</label>
                                  <div class="col-sm-10">
                                              <input type="number" maxlength="10" class="form-control" name="document" id="document" value=""
                                              required  placeholder="enter the document">
                                              <div class="valid-feedback">
                                                  Looks good!
                                              </div>
                                              <div class="invalid-feedback">
                                                  Ingrese el codigo.
                                              </div>
                                              <br>    
                                          </div>

                                  <label class="col-sm-2 col-form-label">email</label>
                                  <div class="col-sm-10">
                                              <input type="email" class="form-control" name="email" id="email" value=""
                                              required  placeholder="enter the  email">
                                              <div class="valid-feedback">
                                                  Looks good!
                                              </div>
                                              <div class="invalid-feedback">
                                                  Ingrese el codigo.
                                              </div>
                                              <br>    
                                          </div>

                                          <label class="col-sm-2 col-form-label">phone</label>
                                          <div class="col-sm-10">
                                                      <input type="text" class="form-control" name="phone" id="phone" value=""
                                                      required  placeholder="enter the phone">
                                                      <div class="valid-feedback">
                                                          Looks good!
                                                      </div>
                                                      <div class="invalid-feedback">
                                                          Ingrese el codigo.
                                                      </div>
                                                      <br>    
                                                  </div>
                                            
                                          <label class="col-sm-2 col-form-label">dateOfBirth</label>
                                          <div class="col-sm-10">
                                              <input type="date" class="form-control" name="date_of_birth" id="dateOfBirth" value="" placeholder="Date of birth">
                                          
                                                      <div class="valid-feedback">
                                                          Looks good!
                                                      </div>
                                                      <div class="invalid-feedback">
                                                          Ingrese el codigo.
                                                      </div>
                                                      <br>    
                                                  </div>    
                                          
                                                  <label class="col-sm-2 col-form-label">gender</label>
                                          <div class="col-sm-10">
                                              <select class="form-select" id="gender"></select> 
                                              <div class="valid-feedback">
                                                  Looks good!
                                              </div>
                                              <div class="invalid-feedback">
                                                  Ingrese el codigo.
                                              </div>
                                              <br>
                                          </div>     
                                                          
                                                   
                                          <label class="col-sm-2 col-form-label">address</label>
                                          <div class="col-sm-10">
                                                      <select class="form-control1" id="address" name="address"></select>
                                                      -
                                                      <input type="number" class="form-control1" name="numeral" id="numeral"
                                                       value=""required  placeholder="enter #">
                                                       -
                                                       <input type="text" class="form-control1" name="numeral2" id="numeral2"
                                                       value=""required  placeholder="enter #">

                                                      -
                                                       <input type="text" class="form-control1" name="description" id="description" 
                                                       value=""required  placeholder="enter Description">  
                                                      
                                                      <div class="valid-feedback">
                                                          Looks good!
                                                      </div>
                                                      <div class="invalid-feedback">
                                                          Ingrese el codigo.
                                                      </div>
                                                      <br>    
                                                  </div>       
                                  
                                

                                           <label class="col-sm-2 col-form-label" for="city_id">city: </label>
                                          <div class="col-sm-10">
                                              <input type="hidden" id="selected_city_id" name="selected_city_id"
                                                  value="">
                                              <input type="text" list="city_id" class="form-control" name="city_id"
                                                  id="city_id">
                                  
                                  </div>
            
                          </fieldset>
                      </div>
                  </div>
                  <div class="modal-footer">
                          <button type="button" name="btnCloced" class="btn btn-secondary" data-bs-dismiss="modal" onclick="clearData()">Close</button>
                          <br>
                          <button name="btnAgregar" class="btn btn-primary" type="button" onclick="save()" data-bs-dismiss="modal">Agragar</button>
                      </div>
                  </form>
        </div>
      </div>
    </div>
  </div>
  

    <table  class="table table-hover">
        <thead>
            <tr class="table-dark">
            <th scope="col">Name</th>
            <th scope="col">Code</th>
            <th scope="col">Emeil</th>
            <th scope="col">phone</th>
          
            <th scope="col">State</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody class="table-group-divider" id="resultData">
            
            
        </tbody>
      </table>
  
     
    </div>

 
  <script type="application/javascript" src="/Frontend Service-security/js/Security/customer.js"></script>
  <script src="/Frontend Service-security/js/Features/ajaxFunctions.js"></script>

  </script>

  <script>
    loadPerson();
        loadData();
       
        loadCity();

        $(document).ready(function() {
    console.log("api consumiendo");
    $('#TypeDocument').change(function() {
        var typeDocumentValue = $(this).val();
        console.log("dato a consultar" +typeDocumentValue);

        $.ajax({
            url: "http://localhost:9000/service-security/v1/api/person/string/" + typeDocumentValue,
            method: "GET",
            dataType: "json",
            success: function(response) {
                if (response.status && Array.isArray(response.data)) {
                    var data = response.data;
                    var documentList = data.map(function(item) {
                        return {
                            label: item.document + " - " + item.firstName + " " + item.lastName,
                            value: item.id
                        };
                    });

                    $("#document_id").autocomplete({
    source: function(request, response) {
        var results = $.ui.autocomplete.filter(documentList, request.term);
        if (!results.length) {
            results = [{ label: 'No se encontraron resultados', value: null }];
        } else {
            // Filtrar el mensaje "No se encontraron resultados" para que no sea seleccionable
            results = results.filter(function(item) {
                return item.value !== null;
            });
        }

        // Comprobar si el primer elemento es el mensaje "No se encontraron resultados" y eliminarlo
        if (results.length && results[0].value === null) {
            results.shift(); // Eliminar el primer elemento del array
        }

        response(results);
    },
    select: function(event, ui) {
        if (ui.item && ui.item.value !== null) {
            $("#selected_document_id").val(ui.item.value);
            var parts = ui.item.label.split(" - ");
            var documentNumber = parts[0];
            var firstName = parts[1];

            $("#document_id").val(documentNumber);
            $("#firstName_id").val(firstName);
            console.log("ID de ciudad seleccionada: " + ui.item.value);

            $("#searchButton").removeAttr("data-bs-toggle");
            $("#searchButton").off("click").on("click", add);
            $("#searchButton").text("add");
        } else {
            $("#searchButton").attr("data-bs-toggle", "modal");
            $("#searchButton").off("click").on("click", save);
            $("#searchButton").text("save");
        }

        return false;
    },
    response: function(event, ui) {
        if (ui.content.length === 0 || (ui.content.length === 1 && ui.content[0].value === null)) {
            $("#searchButton").attr("data-bs-toggle", "modal");
            $("#searchButton").off("click").on("click", save);
            $("#searchButton").text("save");
        } else {
            $("#searchButton").removeAttr("data-bs-toggle");
            $("#searchButton").text("add");
            $("#searchButton").off("click").on("click", add);
        }
    }
});

                } else {
                    console.error("Error: No se pudo obtener la lista de ciudades.");
                }
            },
            error: function(error) {
                console.error("Error en la solicitud:", error);
            }
        });
    });
});


        </script>
    

</body>
</html>